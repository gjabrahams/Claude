<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Scoring System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section h3 {
            color: #2a5298;
            margin-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .form-col {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #2a5298, #1e3c72);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(42, 82, 152, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
        }

        .scorecard {
            overflow-x: auto;
            margin-top: 20px;
        }

        .scorecard-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .scorecard-table th,
        .scorecard-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }

        .scorecard-table th {
            background: linear-gradient(135deg, #2a5298, #1e3c72);
            color: white;
            font-weight: 600;
        }

        .scorecard-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .score-input {
            width: 60px;
            padding: 8px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .summary-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #2a5298;
        }

        .summary-card h4 {
            color: #2a5298;
            margin-bottom: 10px;
        }

        .team-summary {
            background: linear-gradient(135deg, #e8f5e8, #d4edda);
            border-left-color: #28a745;
        }

        .export-section {
            text-align: center;
            margin-top: 30px;
        }

        .hidden {
            display: none;
        }

        .mode-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 15px;
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #2a5298, #1e3c72);
            color: white;
            border-color: #2a5298;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .summary-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚õ≥ Golf Scoring System</h1>
            <p>Professional Golf Scorecard with Betterball Support</p>
        </div>

        <!-- Setup Section -->
        <div class="card" id="setup">
            <div class="form-section">
                <h3>Course Selection</h3>
                <div class="form-group">
                    <label for="course">Select Course:</label>
                    <select id="course" onchange="toggleCustomCourse()">
                        <option value="">Choose a course...</option>
                        <optgroup label="üáøüá¶ South African Courses">
                            <option value="gary-player-cc">Gary Player Country Club (Sun City)</option>
                            <option value="fancourt-links">Fancourt Links (George)</option>
                            <option value="leopard-creek">Leopard Creek Country Club</option>
                            <option value="arabella">Arabella Golf Club (Hermanus)</option>
                            <option value="pearl-valley">Pearl Valley Golf Estate (Paarl)</option>
                            <option value="durban-country-club">Durban Country Club</option>
                            <option value="stellenbosch">Stellenbosch Golf Club</option>
                        </optgroup>
                        <optgroup label="üåç International Courses">
                            <option value="pebble-beach">Pebble Beach Golf Links (USA)</option>
                            <option value="augusta-national">Augusta National Golf Club (USA)</option>
                        </optgroup>
                        <option value="custom">üèóÔ∏è Create Custom Course</option>
                    </select>
                </div>

                <!-- Custom Course Configuration -->
                <div id="customCourseConfig" class="hidden" style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px; border: 2px dashed #2a5298;">
                    <h4 style="color: #2a5298; margin-bottom: 15px;">üèóÔ∏è Custom Course Configuration</h4>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="customCourseName">Course Name:</label>
                            <input type="text" id="customCourseName" placeholder="Enter course name">
                        </div>
                        <div class="form-col">
                            <label for="customCourseLocation">Location (Optional):</label>
                            <input type="text" id="customCourseLocation" placeholder="City, Province/State">
                        </div>
                    </div>

                    <div style="margin: 20px 0;">
                        <h5 style="color: #555; margin-bottom: 10px;">Hole Configuration:</h5>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
                                <thead>
                                    <tr style="background: #2a5298; color: white;">
                                        <th style="padding: 10px; text-align: center;">Hole</th>
                                        <th style="padding: 10px; text-align: center;">Par</th>
                                        <th style="padding: 10px; text-align: center;">Stroke Index</th>
                                    </tr>
                                </thead>
                                <tbody id="customHolesTable">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 15px;">
                        <button type="button" class="btn" onclick="resetCustomCourse()">Reset to Par 4s</button>
                        <button type="button" class="btn" onclick="autoGenerateSI()">Auto-Generate Stroke Index</button>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>Game Mode</h3>
                <div class="mode-toggle">
                    <div class="mode-btn active" onclick="setMode('individual')">
                        <strong>Individual</strong><br>
                        <small>Track individual scores and points</small>
                    </div>
                    <div class="mode-btn" onclick="setMode('betterball')">
                        <strong>Betterball</strong><br>
                        <small>Team format (2 vs 2)</small>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>Player Information</h3>
                <div class="form-row">
                    <div class="form-col">
                        <label for="player1Name">Player 1 Name:</label>
                        <input type="text" id="player1Name" placeholder="Enter name">
                    </div>
                    <div class="form-col">
                        <label for="player1Handicap">Handicap:</label>
                        <input type="number" id="player1Handicap" placeholder="0" min="0" max="54">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label for="player2Name">Player 2 Name:</label>
                        <input type="text" id="player2Name" placeholder="Enter name">
                    </div>
                    <div class="form-col">
                        <label for="player2Handicap">Handicap:</label>
                        <input type="number" id="player2Handicap" placeholder="0" min="0" max="54">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label for="player3Name">Player 3 Name:</label>
                        <input type="text" id="player3Name" placeholder="Enter name">
                    </div>
                    <div class="form-col">
                        <label for="player3Handicap">Handicap:</label>
                        <input type="number" id="player3Handicap" placeholder="0" min="0" max="54">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label for="player4Name">Player 4 Name:</label>
                        <input type="text" id="player4Name" placeholder="Enter name">
                    </div>
                    <div class="form-col">
                        <label for="player4Handicap">Handicap:</label>
                        <input type="number" id="player4Handicap" placeholder="0" min="0" max="54">
                    </div>
                </div>
            </div>

            <button class="btn" onclick="startGame()">Start Game</button>
        </div>

        <!-- Scorecard Section -->
        <div class="card hidden" id="scorecard">
            <div class="form-section">
                <h3 id="scorecardTitle">Scorecard</h3>
                <div class="scorecard">
                    <table class="scorecard-table" id="scorecardTable">
                        <!-- Table will be generated by JavaScript -->
                    </table>
                </div>
            </div>

            <div class="form-section">
                <button class="btn" onclick="calculateScores()">Calculate Scores</button>
                <button class="btn btn-warning" onclick="resetGame()">New Game</button>
            </div>
        </div>

        <!-- Summary Section -->
        <div class="card hidden" id="summary">
            <div class="form-section">
                <h3>Final Summary</h3>
                <div class="summary-section" id="summaryContent">
                    <!-- Summary will be generated by JavaScript -->
                </div>
            </div>

            <div class="export-section">
                <button class="btn btn-success" onclick="exportToPDF()">üìÑ Export to PDF</button>
                <button class="btn btn-success" onclick="exportToExcel()">üìä Export to Excel</button>
                <button class="btn btn-warning" onclick="resetGame()">New Game</button>
            </div>
        </div>
    </div>

    <script>
        let gameData = {
            course: '',
            mode: 'individual',
            players: [],
            holes: [],
            scores: {},
            customCourse: null
        };

        const courseData = {
            'gary-player-cc': {
                name: 'Gary Player Country Club (Sun City)',
                location: 'Sun City, North West Province',
                holes: [
                    {par: 4, si: 14}, {par: 4, si: 6}, {par: 3, si: 18}, {par: 4, si: 4},
                    {par: 5, si: 12}, {par: 4, si: 10}, {par: 3, si: 16}, {par: 4, si: 1},
                    {par: 5, si: 8}, {par: 5, si: 2}, {par: 4, si: 15}, {par: 3, si: 17},
                    {par: 5, si: 13}, {par: 4, si: 5}, {par: 4, si: 11}, {par: 4, si: 3},
                    {par: 3, si: 9}, {par: 4, si: 7}
                ]
            },
            'fancourt-links': {
                name: 'Fancourt Links',
                location: 'George, Western Cape',
                holes: [
                    {par: 4, si: 9}, {par: 4, si: 13}, {par: 4, si: 5}, {par: 3, si: 17},
                    {par: 4, si: 1}, {par: 5, si: 11}, {par: 3, si: 15}, {par: 4, si: 3},
                    {par: 5, si: 7}, {par: 4, si: 16}, {par: 4, si: 2}, {par: 3, si: 18},
                    {par: 4, si: 6}, {par: 5, si: 12}, {par: 4, si: 4}, {par: 4, si: 14},
                    {par: 3, si: 10}, {par: 5, si: 8}
                ]
            },
            'leopard-creek': {
                name: 'Leopard Creek Country Club',
                location: 'Malelane, Mpumalanga',
                holes: [
                    {par: 4, si: 12}, {par: 5, si: 8}, {par: 4, si: 4}, {par: 3, si: 16},
                    {par: 4, si: 2}, {par: 4, si: 14}, {par: 3, si: 18}, {par: 5, si: 6},
                    {par: 4, si: 10}, {par: 4, si: 15}, {par: 4, si: 1}, {par: 3, si: 17},
                    {par: 5, si: 5}, {par: 4, si: 11}, {par: 4, si: 3}, {par: 4, si: 13},
                    {par: 3, si: 9}, {par: 5, si: 7}
                ]
            },
            'arabella': {
                name: 'Arabella Golf Club',
                location: 'Hermanus, Western Cape',
                holes: [
                    {par: 4, si: 13}, {par: 4, si: 5}, {par: 5, si: 9}, {par: 3, si: 17},
                    {par: 4, si: 1}, {par: 4, si: 11}, {par: 4, si: 7}, {par: 3, si: 15},
                    {par: 5, si: 3}, {par: 4, si: 18}, {par: 4, si: 6}, {par: 4, si: 12},
                    {par: 3, si: 16}, {par: 5, si: 2}, {par: 4, si: 8}, {par: 4, si: 14},
                    {par: 3, si: 10}, {par: 5, si: 4}
                ]
            },
            'pearl-valley': {
                name: 'Pearl Valley Golf Estate',
                location: 'Paarl, Western Cape',
                holes: [
                    {par: 4, si: 11}, {par: 5, si: 7}, {par: 4, si: 15}, {par: 3, si: 17},
                    {par: 4, si: 3}, {par: 4, si: 13}, {par: 3, si: 9}, {par: 5, si: 1},
                    {par: 4, si: 5}, {par: 4, si: 18}, {par: 4, si: 2}, {par: 4, si: 12},
                    {par: 3, si: 16}, {par: 5, si: 6}, {par: 4, si: 4}, {par: 4, si: 14},
                    {par: 3, si: 10}, {par: 5, si: 8}
                ]
            },
            'durban-country-club': {
                name: 'Durban Country Club',
                location: 'Durban, KwaZulu-Natal',
                holes: [
                    {par: 4, si: 14}, {par: 4, si: 8}, {par: 4, si: 4}, {par: 3, si: 16},
                    {par: 4, si: 2}, {par: 5, si: 12}, {par: 4, si: 6}, {par: 3, si: 18},
                    {par: 5, si: 10}, {par: 4, si: 15}, {par: 4, si: 1}, {par: 4, si: 13},
                    {par: 3, si: 17}, {par: 5, si: 5}, {par: 4, si: 9}, {par: 4, si: 3},
                    {par: 3, si: 11}, {par: 5, si: 7}
                ]
            },
            'stellenbosch': {
                name: 'Stellenbosch Golf Club',
                location: 'Stellenbosch, Western Cape',
                holes: [
                    {par: 4, si: 9}, {par: 4, si: 13}, {par: 3, si: 15}, {par: 5, si: 3},
                    {par: 4, si: 7}, {par: 4, si: 11}, {par: 4, si: 1}, {par: 3, si: 17},
                    {par: 5, si: 5}, {par: 4, si: 18}, {par: 4, si: 2}, {par: 4, si: 12},
                    {par: 3, si: 16}, {par: 4, si: 6}, {par: 5, si: 8}, {par: 4, si: 4},
                    {par: 3, si: 14}, {par: 5, si: 10}
                ]
            },
            'pebble-beach': {
                name: 'Pebble Beach Golf Links',
                location: 'California, USA',
                holes: [
                    {par: 4, si: 11}, {par: 5, si: 7}, {par: 4, si: 15}, {par: 4, si: 3},
                    {par: 3, si: 17}, {par: 5, si: 5}, {par: 3, si: 13}, {par: 4, si: 1},
                    {par: 4, si: 9}, {par: 4, si: 8}, {par: 4, si: 12}, {par: 3, si: 18},
                    {par: 4, si: 4}, {par: 5, si: 6}, {par: 4, si: 14}, {par: 4, si: 10},
                    {par: 3, si: 16}, {par: 5, si: 2}
                ]
            },
            'augusta-national': {
                name: 'Augusta National Golf Club',
                location: 'Georgia, USA',
                holes: [
                    {par: 4, si: 10}, {par: 5, si: 16}, {par: 4, si: 4}, {par: 3, si: 14},
                    {par: 4, si: 6}, {par: 3, si: 18}, {par: 4, si: 2}, {par: 5, si: 12},
                    {par: 4, si: 8}, {par: 4, si: 9}, {par: 4, si: 5}, {par: 3, si: 17},
                    {par: 5, si: 3}, {par: 4, si: 11}, {par: 5, si: 1}, {par: 3, si: 15},
                    {par: 4, si: 7}, {par: 4, si: 13}
                ]
            },
            'custom': {
                name: 'Custom Course',
                location: 'User Defined',
                holes: Array(18).fill().map((_, i) => ({par: 4, si: i + 1}))
            }
        };

        function toggleCustomCourse() {
            const course = document.getElementById('course').value;
            const customConfig = document.getElementById('customCourseConfig');
            
            if (course === 'custom') {
                customConfig.classList.remove('hidden');
                generateCustomHolesTable();
            } else {
                customConfig.classList.add('hidden');
            }
        }

        function generateCustomHolesTable() {
            const tbody = document.getElementById('customHolesTable');
            let html = '';
            
            for (let i = 1; i <= 18; i++) {
                html += `
                    <tr style="border-bottom: 1px solid #ddd;">
                        <td style="padding: 8px; text-align: center; font-weight: 600;">${i}</td>
                        <td style="padding: 8px; text-align: center;">
                            <select id="customPar${i}" style="width: 60px; padding: 4px; text-align: center;">
                                <option value="3">3</option>
                                <option value="4" selected>4</option>
                                <option value="5">5</option>
                            </select>
                        </td>
                        <td style="padding: 8px; text-align: center;">
                            <input type="number" id="customSI${i}" min="1" max="18" value="${i}" 
                                   style="width: 60px; padding: 4px; text-align: center;">
                        </td>
                    </tr>
                `;
            }
            tbody.innerHTML = html;
        }

        function resetCustomCourse() {
            for (let i = 1; i <= 18; i++) {
                document.getElementById(`customPar${i}`).value = '4';
                document.getElementById(`customSI${i}`).value = i;
            }
        }

        function autoGenerateSI() {
            // Generate a realistic stroke index distribution
            const siValues = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18];
            
            // Shuffle array for random distribution
            for (let i = siValues.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [siValues[i], siValues[j]] = [siValues[j], siValues[i]];
            }
            
            // Assign to holes
            for (let i = 1; i <= 18; i++) {
                document.getElementById(`customSI${i}`).value = siValues[i - 1];
            }
        }

        function validateCustomCourse() {
            const name = document.getElementById('customCourseName').value.trim();
            if (!name) {
                alert('Please enter a course name');
                return false;
            }

            // Check for duplicate stroke indexes
            const siValues = [];
            for (let i = 1; i <= 18; i++) {
                const si = parseInt(document.getElementById(`customSI${i}`).value);
                if (siValues.includes(si)) {
                    alert(`Duplicate stroke index found: ${si}. Each hole must have a unique stroke index from 1-18.`);
                    return false;
                }
                siValues.push(si);
            }

            // Check if all stroke indexes 1-18 are used
            const sortedSI = siValues.sort((a, b) => a - b);
            for (let i = 1; i <= 18; i++) {
                if (!sortedSI.includes(i)) {
                    alert(`Missing stroke index: ${i}. Please ensure all stroke indexes from 1-18 are used.`);
                    return false;
                }
            }

            return true;
        }

        function buildCustomCourse() {
            const name = document.getElementById('customCourseName').value.trim();
            const location = document.getElementById('customCourseLocation').value.trim();
            
            const holes = [];
            for (let i = 1; i <= 18; i++) {
                const par = parseInt(document.getElementById(`customPar${i}`).value);
                const si = parseInt(document.getElementById(`customSI${i}`).value);
                holes.push({ par: par, si: si });
            }

            gameData.customCourse = {
                name: name,
                location: location,
                holes: holes
            };

            return gameData.customCourse;
        }

        function setMode(mode) {
            gameData.mode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.mode-btn').classList.add('active');
        }

        function startGame() {
            const course = document.getElementById('course').value;
            if (!course) {
                alert('Please select a course');
                return;
            }

            gameData.course = course;
            
            // Handle custom course
            if (course === 'custom') {
                if (!validateCustomCourse()) {
                    return;
                }
                buildCustomCourse();
                gameData.holes = gameData.customCourse.holes;
            } else {
                gameData.holes = courseData[course].holes;
            }
            
            // Collect player data
            gameData.players = [];
            for (let i = 1; i <= 4; i++) {
                const name = document.getElementById(`player${i}Name`).value;
                const handicap = parseInt(document.getElementById(`player${i}Handicap`).value) || 0;
                if (name) {
                    gameData.players.push({
                        id: i,
                        name: name,
                        handicap: handicap,
                        team: i <= 2 ? 'A' : 'B'
                    });
                }
            }

            if (gameData.players.length < 2) {
                alert('Please enter at least 2 players');
                return;
            }

            generateScorecard();
            document.getElementById('setup').classList.add('hidden');
            document.getElementById('scorecard').classList.remove('hidden');
        }

        function generateScorecard() {
            const table = document.getElementById('scorecardTable');
            let courseInfo, courseName, courseLocation;
            
            // Handle custom course
            if (gameData.course === 'custom' && gameData.customCourse) {
                courseInfo = gameData.customCourse;
                courseName = courseInfo.name;
                courseLocation = courseInfo.location;
            } else {
                courseInfo = courseData[gameData.course];
                courseName = courseInfo.name;
                courseLocation = courseInfo.location || '';
            }
            
            document.getElementById('scorecardTitle').textContent = `${courseName} ${courseLocation ? `(${courseLocation})` : ''} - ${gameData.mode === 'betterball' ? 'Betterball' : 'Individual'} Scorecard`;

            let html = '<thead><tr><th>Hole</th>';
            
            // Add hole numbers
            for (let i = 1; i <= 18; i++) {
                html += `<th>${i}</th>`;
            }
            html += '<th>Total</th></tr>';

            // Add par row
            html += '<tr><th>Par</th>';
            gameData.holes.forEach(hole => {
                html += `<td>${hole.par}</td>`;
            });
            html += '<td>' + gameData.holes.reduce((sum, hole) => sum + hole.par, 0) + '</td></tr>';

            // Add stroke index row
            html += '<tr><th>SI</th>';
            gameData.holes.forEach(hole => {
                html += `<td>${hole.si}</td>`;
            });
            html += '<td>-</td></tr></thead><tbody>';

            // Add player rows
            gameData.players.forEach(player => {
                html += `<tr><th>${player.name} (${player.handicap})</th>`;
                for (let i = 1; i <= 18; i++) {
                    html += `<td><input type="number" class="score-input" id="score_${player.id}_${i}" min="1" max="10" onchange="updateTotals()"></td>`;
                }
                html += `<td id="total_${player.id}">0</td></tr>`;
                
                // Add points row for each player
                html += `<tr><th>${player.name} Points</th>`;
                for (let i = 1; i <= 18; i++) {
                    html += `<td id="points_${player.id}_${i}">0</td>`;
                }
                html += `<td id="totalPoints_${player.id}">0</td></tr>`;
            });

            // Add betterball rows if in betterball mode
            if (gameData.mode === 'betterball') {
                html += '<tr style="background-color: #e8f5e8;"><th><strong>Team A Best</strong></th>';
                for (let i = 1; i <= 18; i++) {
                    html += `<td id="teamA_${i}">-</td>`;
                }
                html += '<td id="teamA_total">0</td></tr>';

                html += '<tr style="background-color: #fff3cd;"><th><strong>Team B Best</strong></th>';
                for (let i = 1; i <= 18; i++) {
                    html += `<td id="teamB_${i}">-</td>`;
                }
                html += '<td id="teamB_total">0</td></tr>';
            }

            html += '</tbody>';
            table.innerHTML = html;
        }

        function updateTotals() {
            gameData.players.forEach(player => {
                let totalStrokes = 0;
                let totalPoints = 0;

                for (let hole = 1; hole <= 18; hole++) {
                    const scoreInput = document.getElementById(`score_${player.id}_${hole}`);
                    const score = parseInt(scoreInput.value) || 0;
                    
                    if (score > 0) {
                        totalStrokes += score;
                        
                        // Calculate stableford points
                        const par = gameData.holes[hole - 1].par;
                        const si = gameData.holes[hole - 1].si;
                        const handicapStrokes = Math.floor(player.handicap / 18) + (si <= (player.handicap % 18) ? 1 : 0);
                        const netScore = score - handicapStrokes;
                        
                        let points = 0;
                        if (netScore <= par - 2) points = 4;
                        else if (netScore === par - 1) points = 3;
                        else if (netScore === par) points = 2;
                        else if (netScore === par + 1) points = 1;
                        
                        document.getElementById(`points_${player.id}_${hole}`).textContent = points;
                        totalPoints += points;
                    }
                }

                document.getElementById(`total_${player.id}`).textContent = totalStrokes;
                document.getElementById(`totalPoints_${player.id}`).textContent = totalPoints;
            });

            // Update betterball scores
            if (gameData.mode === 'betterball') {
                updateBetterballScores();
            }
        }

        function updateBetterballScores() {
            let teamATotal = 0;
            let teamBTotal = 0;

            for (let hole = 1; hole <= 18; hole++) {
                const teamAPlayers = gameData.players.filter(p => p.team === 'A');
                const teamBPlayers = gameData.players.filter(p => p.team === 'B');

                let teamABest = null;
                let teamBBest = null;

                // Find best score for Team A
                teamAPlayers.forEach(player => {
                    const pointsEl = document.getElementById(`points_${player.id}_${hole}`);
                    const points = parseInt(pointsEl.textContent) || 0;
                    if (teamABest === null || points > teamABest) {
                        teamABest = points;
                    }
                });

                // Find best score for Team B
                teamBPlayers.forEach(player => {
                    const pointsEl = document.getElementById(`points_${player.id}_${hole}`);
                    const points = parseInt(pointsEl.textContent) || 0;
                    if (teamBBest === null || points > teamBBest) {
                        teamBBest = points;
                    }
                });

                document.getElementById(`teamA_${hole}`).textContent = teamABest || 0;
                document.getElementById(`teamB_${hole}`).textContent = teamBBest || 0;

                teamATotal += teamABest || 0;
                teamBTotal += teamBBest || 0;
            }

            document.getElementById('teamA_total').textContent = teamATotal;
            document.getElementById('teamB_total').textContent = teamBTotal;
        }

        function calculateScores() {
            updateTotals();
            generateSummary();
            document.getElementById('summary').classList.remove('hidden');
            document.getElementById('summary').scrollIntoView({ behavior: 'smooth' });
        }

        function generateSummary() {
            const summaryContent = document.getElementById('summaryContent');
            let html = '';

            // Individual summaries
            gameData.players.forEach(player => {
                const totalStrokes = parseInt(document.getElementById(`total_${player.id}`).textContent) || 0;
                const totalPoints = parseInt(document.getElementById(`totalPoints_${player.id}`).textContent) || 0;
                const netScore = totalStrokes - player.handicap;

                html += `
                    <div class="summary-card">
                        <h4>${player.name}</h4>
                        <p><strong>Gross Score:</strong> ${totalStrokes}</p>
                        <p><strong>Net Score:</strong> ${netScore}</p>
                        <p><strong>Handicap:</strong> ${player.handicap}</p>
                        <p><strong>Stableford Points:</strong> ${totalPoints}</p>
                    </div>
                `;
            });

            // Betterball summary
            if (gameData.mode === 'betterball') {
                const teamATotal = parseInt(document.getElementById('teamA_total').textContent) || 0;
                const teamBTotal = parseInt(document.getElementById('teamB_total').textContent) || 0;
                const teamAPlayers = gameData.players.filter(p => p.team === 'A').map(p => p.name).join(' & ');
                const teamBPlayers = gameData.players.filter(p => p.team === 'B').map(p => p.name).join(' & ');

                html += `
                    <div class="summary-card team-summary">
                        <h4>Team A: ${teamAPlayers}</h4>
                        <p><strong>Betterball Points:</strong> ${teamATotal}</p>
                        ${teamATotal > teamBTotal ? '<p style="color: #28a745;"><strong>üèÜ WINNER!</strong></p>' : ''}
                    </div>
                    <div class="summary-card team-summary">
                        <h4>Team B: ${teamBPlayers}</h4>
                        <p><strong>Betterball Points:</strong> ${teamBTotal}</p>
                        ${teamBTotal > teamATotal ? '<p style="color: #28a745;"><strong>üèÜ WINNER!</strong></p>' : ''}
                    </div>
                `;
            }

            summaryContent.innerHTML = html;
        }

        function exportToPDF() {
            const { jsPDF } = window.jsPdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('Golf Scorecard', 20, 20);
            
            doc.setFontSize(12);
            
            // Get course name - handle custom course
            let courseName;
            if (gameData.course === 'custom' && gameData.customCourse) {
                courseName = gameData.customCourse.name;
                if (gameData.customCourse.location) {
                    courseName += ` (${gameData.customCourse.location})`;
                }
            } else {
                const courseInfo = courseData[gameData.course];
                courseName = courseInfo.name;
                if (courseInfo.location) {
                    courseName += ` (${courseInfo.location})`;
                }
            }
            
            doc.text(`Course: ${courseName}`, 20, 35);
            doc.text(`Mode: ${gameData.mode === 'betterball' ? 'Betterball' : 'Individual'}`, 20, 45);
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, 55);
            
            let yPos = 70;
            gameData.players.forEach(player => {
                const totalStrokes = parseInt(document.getElementById(`total_${player.id}`).textContent) || 0;
                const totalPoints = parseInt(document.getElementById(`totalPoints_${player.id}`).textContent) || 0;
                
                doc.text(`${player.name} (HCP: ${player.handicap})`, 20, yPos);
                doc.text(`Gross: ${totalStrokes} | Points: ${totalPoints}`, 20, yPos + 10);
                yPos += 25;
            });
            
            if (gameData.mode === 'betterball') {
                const teamATotal = parseInt(document.getElementById('teamA_total').textContent) || 0;
                const teamBTotal = parseInt(document.getElementById('teamB_total').textContent) || 0;
                
                doc.text('Betterball Results:', 20, yPos);
                doc.text(`Team A: ${teamATotal} points`, 20, yPos + 15);
                doc.text(`Team B: ${teamBTotal} points`, 20, yPos + 25);
                
                if (teamATotal > teamBTotal) {
                    doc.text('Winner: Team A', 20, yPos + 40);
                } else if (teamBTotal > teamATotal) {
                    doc.text('Winner: Team B', 20, yPos + 40);
                } else {
                    doc.text('Result: Tie', 20, yPos + 40);
                }
            }
            
            doc.save('golf-scorecard.pdf');
        }

        function exportToExcel() {
            const wb = XLSX.utils.book_new();
            
            // Create scorecard data
            const scorecardData = [];
            
            // Headers
            const headers = ['Player', 'Handicap'];
            for (let i = 1; i <= 18; i++) {
                headers.push(`Hole ${i}`);
            }
            headers.push('Total Strokes', 'Total Points');
            scorecardData.push(headers);
            
            // Player data
            gameData.players.forEach(player => {
                const row = [player.name, player.handicap];
                for (let hole = 1; hole <= 18; hole++) {
                    const scoreInput = document.getElementById(`score_${player.id}_${hole}`);
                    row.push(parseInt(scoreInput.value) || 0);
                }
                row.push(
                    parseInt(document.getElementById(`total_${player.id}`).textContent) || 0,
                    parseInt(document.getElementById(`totalPoints_${player.id}`).textContent) || 0
                );
                scorecardData.push(row);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(scorecardData);
            XLSX.utils.book_append_sheet(wb, ws, 'Scorecard');
            
            XLSX.writeFile(wb, 'golf-scorecard.xlsx');
        }

        function resetGame() {
            gameData = {
                course: '',
                mode: 'individual',
                players: [],
                holes: [],
                scores: {},
                customCourse: null
            };
            
            document.getElementById('setup').classList.remove('hidden');
            document.getElementById('scorecard').classList.add('hidden');
            document.getElementById('summary').classList.add('hidden');
            document.getElementById('customCourseConfig').classList.add('hidden');
            
            // Clear form
            document.getElementById('course').value = '';
            document.getElementById('customCourseName').value = '';
            document.getElementById('customCourseLocation').value = '';
            
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`player${i}Name`).value = '';
                document.getElementById(`player${i}Handicap`).value = '';
            }
            
            // Reset mode
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.mode-btn').classList.add('active');
            gameData.mode = 'individual';
        }
    </script>
</body>
</html>
